# 代理模式

## 概念

### 定义

代理模式：由于某些原因需要给某个对象提供一个代理以控制对该对象的访问。这时，代理对象作为访问对象与目标对象的中介。

### 特点

1. 访问对象不直接与目标对象交互，而是与代理对象通信。
2. 减轻了访问对象的结构复杂度，因为与目标对象的交互在代理对象中进行了处理。
3. 在**保护目标对象**的同时还可以**增强目标对象**。

## 结构和实现

### 结构



代理模式结构图如下：

![代理模式结构图](https://i.loli.net/2020/09/21/5JzBIVhiG1H4T6W.png)

代理模式的主要角色如下。

1. 抽象主题（Subject）类：通过接口或抽象类声明真实主题和代理对象实现的业务方法。
2. 真实主题（Real Subject）类：实现了抽象主题中的具体业务，是代理对象所代表的真实对象，是最终要引用的对象。
3. 代理（Proxy）类：提供了与真实主题相同的接口，其内部含有对真实主题的引用，它可以访问、控制或扩展真实主题的功能。

### 实现

**抽象主题类**

```java
interface Subject {
    void show();
}
```

**真实主题类**

```java
class RealSubject implements Subject {
    public void show() {
        System.out.println("访问真实主题方法...");
    }
}
```

**代理类**

```java
class ProxySubject implements Subject {
    
    private RealSubject realSubject;
    
    public void show() {
        if (realSubject == null) {
            realSubject = new RealSubject();
        }
        realSubject.show();
    }
    
    // 可以用来做一些其他操作来增强目标对象即RealSubject的功能
    public void other() {
        // ...
    }
}
```

**客户端**

```java
public class ProxyTest {
	public static void main(String[] args) {
        ProxySubject proxy = new ProxySubject();
        proxy.show();
    }
}
```

## 代理模式的优点和缺点

代理模式的优点：

- 代理模式在客户端与目标对象之间起到一个中介作用和保护目标对象的作用；
- 代理对象可以扩展目标对象的功能；
- 代理模式能将客户端与目标对象分离，在一定程度上降低了系统的耦合度，增加了程序的可扩展性；


代理模式的缺点：

- 代理模式会造成系统设计中类的数量增加；
- 在客户端和目标对象之间增加一个代理对象，会造成请求处理速度变慢；
- 增加了系统的复杂度；

## 代理模式的应用场景

按职责来划分，通常有以下使用场景：  

- 远程代理，这种方式通常是为了隐藏目标对象存在于不同地址空间的事实，方便客户端访问。例如，用户申请某些网盘空间时，会在用户的文件系统中建立一个虚拟的硬盘，用户访问虚拟硬盘时实际访问的是网盘空间。
- 虚拟代理，这种方式通常用于要创建的目标对象开销很大时。例如，下载一幅很大的图像需要很长时间，因某种计算比较复杂而短时间无法完成，这时可以先用小比例的虚拟代理替换真实的对象，消除用户对服务器慢的感觉。
- 安全代理，这种方式通常用于控制不同种类客户对真实对象的访问权限。
- 智能指引，主要用于调用目标对象时，代理附加一些额外的处理功能。例如，增加计算真实对象的引用次数的功能，这样当该对象没有被引用时，就可以自动释放它。
- 延迟加载，指为了提高系统的性能，延迟对目标的加载。例如，[Hibernate](http://c.biancheng.net/hibernate/) 中就存在属性的延迟加载和关联表的延时加载。
- Copy-on-Write 代理，在客户端操作的时候，只有对象确实改变了，才会真的拷贝（或克隆）一个目标对象，算是虚代理的一个分支。  
- 缓存代理，为那些昂贵的操作的结果提供临时的存储空间，以便多个客户端可以共享这些结果。
- 防火墙代理，保护对象不被恶意用户访问和操作。 
- 同步化代理，使多个用户能够同时访问目标对象而没有冲突。 

