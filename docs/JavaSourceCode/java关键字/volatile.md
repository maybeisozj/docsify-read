# volatile 关键字解读

## 概述

volatile关键字可以说是synchronized关键字的轻量版，他保证了共享变量的可见性以及防止一定程度的指令重排。

### 特点

#### 可见性

可见性是指一个线程修改了一个共享变量(**多个线程可访问**)，其中一个修改了该变量的值，其他线程可以立即看到修改的值。

##### Java中存在的可见性问题

在Java内存模型规定所有的变量(**实例字段，静态字段和构成数组对象的元素，不包括局部变量和方法参数，因为它们是线程私有的**)都存储在主内存。每条线程还有自己的工作内存(**是每个线程私有的，类比CPU缓存**)，其中保存了被该线程使用的变量的主内存**副本**，线程对变量的所有操作都必须在工作内存中完成，不能直接对主内存的变量进行操作。**线程间变量值的传递需要通过主内存来完成**。

线程、工作内存、主内存工作交互如下图：

![image-20200701222923473](https://i.loli.net/2020/07/01/EeDXvQNTnRPKgd1.png)

图片来源：深入理解Java虚拟机第三版 12.3.1节。

正如上文所述，由于Java线程会拷贝主内存中的变量，他们的值不一定是相同。